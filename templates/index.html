<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SHAPE Session Analyzer</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; line-height: 1.6; margin: 0; background-color: #f8f9fa; color: #212529; }
        main { max-width: 800px; margin: 2rem auto; padding: 2rem; background-color: #ffffff; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { font-size: 2rem; margin-bottom: 0.5rem; }
        .subtitle { margin-top: 0; color: #6c757d; }
        .form-container { margin-top: 2rem; }
        label { display: block; font-weight: bold; margin-bottom: 0.5rem; }
        input[type="file"] { margin-bottom: 1rem; }
        textarea { width: 100%; min-height: 200px; padding: 0.5rem; border: 1px solid #ced4da; border-radius: 4px; font-family: inherit; }
        button { display: inline-block; background-color: #0d6efd; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; font-size: 1rem; font-weight: bold; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #0b5ed7; }
        .results { margin-top: 2.5rem; border-top: 1px solid #dee2e6; padding-top: 2rem; }
        .card { background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 1.5rem; margin-bottom: 1.5rem; }
        .score { font-size: 4rem; font-weight: bold; text-align: center; color: #0d6efd; }
        .error { color: #dc3545; font-weight: bold; }
        ul { padding-left: 20px; }
    </style>
</head>
<body>
    <main>
        <h1>SHAPE Session Analyzer</h1>
        <p class="subtitle">Understand your AI collaboration and get recommendations for improvement.</p>
        
        <div class="form-container">
            <form method="post" action="/analyze" enctype="multipart/form-data">
                <label for="transcript_file">Upload a transcript file (.docx or .txt)</label>
                <input type="file" id="transcript_file" name="transcript_file" accept=".txt,.docx">

                <label for="transcript_paste">OR paste your transcript below</label>
                <textarea id="transcript_paste" name="transcript_paste" placeholder="Paste your full chat transcript here..."></textarea>
                
                <button type="submit">Analyze Session</button>
            </form>
        </div>

        {% if result %}
        <div class="results">
            {% if result.errors and result.errors|length > 0 %}
                <div class="card error">
                    <h3>Analysis Error</h3>
                    <ul>
                        {% for error in result.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% else %}
                <div class="card">
                    <h3>SHAPE Score & Interpretation</h3>
                    <div class="score">{{ result.score }}</div>
                    <p><strong>Interpretation:</strong> {{ result.interpretation }}</p>
                </div>

                <div class="card">
                    <h3>Recommendations</h3>
                    <p>{{ result.recommendation }}</p>
                </div>

                <div class="card">
                    <h3>Session Statistics</h3>
                    <ul>
                        <li><strong>Total Turns:</strong> {{ result.stats.turns }} ({{ result.stats.user_turns }} Human / {{ result.stats.ai_turns }} AI)</li>
                        <li><strong>Total Words:</strong> {{ result.stats.user_words + result.stats.ai_words }} ({{ result.stats.user_words }} Human / {{ result.stats.ai_words }} AI)</li>
                        <li><strong>AI Contribution Share (by word count):</strong> {{ "%.1f"|format(result.stats.ai_share * 100) }}%</li>
                    </ul>
                </div>
            {% endif %}
        </div>
        {% endif %}
    </main>
</body>
</html>